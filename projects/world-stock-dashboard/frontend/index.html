<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>World Stock Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background: #0d1117; color: #f0f6fc; min-height: 100vh; }
        .header { background: linear-gradient(135deg, #1a1a2e, #16213e); padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #30363d; }
        .header h1 { font-size: 1.4rem; }
        .header h1 span { font-size: 0.6rem; background: #58a6ff; padding: 0.2rem 0.5rem; border-radius: 4px; margin-left: 0.5rem; }
        .btn { background: #58a6ff; color: #fff; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; font-size: 0.9rem; }
        .btn:hover { opacity: 0.8; }
        .btn:disabled { opacity: 0.5; }
        .main { padding: 1.5rem; max-width: 1400px; margin: 0 auto; }
        .api-box { background: #161b22; border: 1px solid #30363d; border-radius: 8px; padding: 1rem; margin-bottom: 1.5rem; }
        .api-box label { font-size: 0.85rem; color: #8b949e; display: block; margin-bottom: 0.5rem; }
        .api-box input { width: 100%; padding: 0.5rem; background: #0d1117; border: 1px solid #30363d; border-radius: 4px; color: #f0f6fc; font-family: monospace; }
        .section { margin-bottom: 2rem; }
        .section-title { font-size: 1rem; color: #8b949e; margin-bottom: 1rem; padding-left: 0.75rem; border-left: 3px solid #58a6ff; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 10px; }
        .card { background: #161b22; border: 1px solid #30363d; border-radius: 8px; padding: 0.85rem; transition: all 0.2s; }
        .card:hover { border-color: #58a6ff; transform: translateY(-2px); }
        .card-name { font-size: 0.85rem; color: #8b949e; }
        .card-symbol { font-size: 0.7rem; color: #6e7681; font-family: monospace; }
        .card-price { font-size: 1.3rem; font-weight: 600; margin: 0.4rem 0; font-family: monospace; }
        .card-change { font-size: 0.85rem; font-family: monospace; }
        .positive { color: #3fb950; }
        .negative { color: #f85149; }
        .card-hl { margin-top: 0.5rem; padding-top: 0.5rem; border-top: 1px solid #30363d; font-size: 0.7rem; color: #6e7681; display: flex; justify-content: space-between; }
        .loading { text-align: center; padding: 3rem; color: #8b949e; }
        .error { background: rgba(248,81,73,0.1); border: 1px solid #f85149; border-radius: 8px; padding: 1rem; color: #f85149; text-align: center; }
        .status { position: fixed; bottom: 0; left: 0; right: 0; background: #161b22; border-top: 1px solid #30363d; padding: 0.5rem 1.5rem; font-size: 0.8rem; color: #8b949e; display: flex; justify-content: space-between; }
        .clock { font-family: monospace; }
    </style>
</head>
<body>
    <header class="header">
        <h1>üìà World Stock Dashboard <span>AWS</span></h1>
        <div style="display:flex;gap:1rem;align-items:center">
            <span class="clock" id="clock"></span>
            <button class="btn" id="refreshBtn" onclick="fetchData()">üîÑ Update</button>
        </div>
    </header>
    
    <main class="main">
        <div class="api-box">
            <label>API URL:</label>
            <input type="text" id="apiUrl" value="https://p17xzb0tef.execute-api.ap-northeast-1.amazonaws.com/prod/stocks">
        </div>
        <div id="content"><div class="loading">Click "Update" to load data</div></div>
    </main>
    
    <div class="status">
        <span id="statusText">Ready</span>
        <span>Last update: <span id="lastUpdate">--</span></span>
    </div>

    <script>
        let data = [];
        
        function updateClock() {
            document.getElementById('clock').textContent = new Date().toLocaleString('ja-JP');
        }
        setInterval(updateClock, 1000);
        updateClock();
        
        async function fetchData() {
            const btn = document.getElementById('refreshBtn');
            btn.disabled = true;
            btn.textContent = '‚è≥ Loading...';
            document.getElementById('statusText').textContent = 'Fetching...';
            
            try {
                const url = document.getElementById('apiUrl').value;
                const res = await fetch(url);
                const json = await res.json();
                
                if (json.success && json.data) {
                    data = json.data;
                    document.getElementById('lastUpdate').textContent = json.timestamp;
                    document.getElementById('statusText').textContent = `${data.length} items loaded`;
                    render();
                } else {
                    throw new Error('Invalid response');
                }
            } catch (e) {
                document.getElementById('content').innerHTML = `<div class="error">Error: ${e.message}</div>`;
                document.getElementById('statusText').textContent = 'Error';
            } finally {
                btn.disabled = false;
                btn.textContent = 'üîÑ Update';
            }
        }
        
        function render() {
            const grouped = {};
            data.forEach(item => {
                if (!grouped[item.category]) grouped[item.category] = [];
                grouped[item.category].push(item);
            });
            
            const order = ['US Index', 'Japan Index', 'World Index', 'Commodity', 'FX', 'Crypto', 'Bond'];
            let html = '';
            
            order.forEach(cat => {
                if (grouped[cat]) {
                    html += `<div class="section"><h2 class="section-title">${cat}</h2><div class="grid">`;
                    grouped[cat].forEach(item => {
                        const cls = item.changePercent >= 0 ? 'positive' : 'negative';
                        const sign = item.changePercent >= 0 ? '+' : '';
                        html += `
                            <div class="card">
                                <div class="card-name">${item.name}</div>
                                <div class="card-symbol">${item.symbol}</div>
                                <div class="card-price">${item.price.toLocaleString()}</div>
                                <div class="card-change ${cls}">${sign}${item.change} (${sign}${item.changePercent}%)</div>
                                <div class="card-hl"><span>H: ${item.high}</span><span>L: ${item.low}</span></div>
                            </div>`;
                    });
                    html += '</div></div>';
                }
            });
            
            document.getElementById('content').innerHTML = html;
        }
        
        // Auto refresh every 5 min
        setInterval(fetchData, 5 * 60 * 1000);
    </script>
</body>
</html>